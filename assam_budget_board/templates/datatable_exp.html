{% load sekizai_tags static %}
{% addtoblock "css" %}
<link rel="stylesheet" type="text/css" href="{% static 'css/nv.d3.min.css' %}">
<link rel="stylesheet" type="text/css" href="{% static 'css/vis.css' %}">
<link rel="stylesheet" type="text/css" href="{% static 'css/datatable.css' %}">
<link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/1.10.19/css/dataTables.bootstrap4.min.css">
{% endaddtoblock %}
    <div class="container">
        <div class="row">
            <div aria-label="Data Table Header" class="data-table-header col-lg-12">
                Data Table
            </div>
        </div>
        <div class="row">
            <div class="data-table-section" id='container-data'>
                
            </div>
        </div>
{% addtoblock "js" %}
<script src="https://d3js.org/d3.v3.min.js"></script>
<script src="{% static 'js/nv.d3.min.js' %}"></script>
<script src="https://cdn.datatables.net/1.10.9/js/jquery.dataTables.min.js"></script>
<script src="{% static 'js/makeTable.js' %}"></script>
<script src="http://labratrevenge.com/d3-tip/javascripts/d3.tip.v0.6.3.js"></script>
<script type="text/javascript" src="https://cdn.datatables.net/1.10.19/js/dataTables.bootstrap4.min.js"></script>
<script>

d3.csv("{{ instance.url }}", function(csv_data) {
        
    var data = d3.nest()
  .key(function(d) { return d['GRANT NUMBER'];})
    .rollup(function(d) { 
   return {
     ac : d3.sum(d, function(g) {return g['ACTUALS 2016-17']; }),
     beprev : d3.sum(d, function(g) {return g['BUDGET 2017-18']; }),
     re : d3.sum(d, function(g) {return g['REVISED 2017-18']; }),
     be : d3.sum(d, function(g) {return g['BUDGET 2018-19']; }),
   }
  }).entries(csv_data);
     grant_data = data.map(function(d)
  {  
     return{
     GRANT_NUMBER : d.key,
     budget : Object.values(d).slice(1)[0].be,
     budgetprev : Object.values(d).slice(1)[0].beprev,
     revised : Object.values(d).slice(1)[0].re,
     actuals : Object.values(d).slice(1)[0].ac
  
     }
  });
        //columns:"GRANT NUMBER,BUDGET ENTITY,HEAD OF ACCOUNT,HEAD DESCRIPTION,HEAD DESCRIPTION ASSAMESE",
        let tableSelect = d3.select('#container-data').append("table")
        .attr("class", "table table-striped table-bordered")
            .attr("id", "exp_table") 
        
        $('#exp_table').DataTable( {
            "processing": true,
            "bLengthChange": false, // Disable page size change
            data: grant_data,
            columns: [
                { "data": "GRANT_NUMBER" ,"title" : "GRANT NUMBER" },
                { "data": 'budget' , "title" : 'BUDGET 2018-19'},
                { "data": 'revised' , "title" : 'REVISED 2017-18'},
                { "data": 'budgetprev' , "title" : 'BUDGET 2017-18'},
                { "data": 'actuals' , "title" : 'ACTUALS 2016-17'},

            ]
        });
    });

</script>

{% endaddtoblock %}